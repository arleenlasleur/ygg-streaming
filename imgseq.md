# Как "стримить" серию изображений

Стрим представляет собой сайт с meta-refresh заголовком, подсасывающий подследний файл, либо страницу с AJAX загрузкой самого нового файла. Внутри <div> оставляются минимум два изображения, чтобы смена была бесшовной. Простой стрим без JS мигает цветом фона страницы.

Порядок действий:

1. В OBS поставить низкий фреймрейт (1, 2, 5 и т п). Fractional фреймрейт не нравится ffmpeg, лучше использовать Integer FPS, так что минимум - единица.

2. Запустить запись в OBS

3. Запустить `str_imgseq.bat`, указав имя файла с записью. FFMPEG будет демультепликсировать .ts файл в серию изображений. Я использую RAM диск ImDiskTk.

4. Чтобы он не переполнился, я кручу файл `del_imgseq.bat`, он удаляет все старые файлы, кроме 5 последних. PHP найдёт самый новый из них. В этих файлах указан путь к серии изображений, в корневом каталоге диска `W:\`, его следует поменять при необходимости.

Если остановить запись в OBS, FFMPEG доберётся до конца файла и остановится. `del_imgseq.bat` надо закрывать вручную.

Чтобы nginx имел доступ к RAM-диску, следует создать символьную ссылку на том диске, на котором находится каталог куда указывает `root`. Относительный путь оттуда написан в начале файла `index1.php`. Например это можно сделать командой `mklink /d yggstream w:\` из каталога на один уровень выше `html2` (так называется мой root).

todo: дописать nojs версию фронтенда